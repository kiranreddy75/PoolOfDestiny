{"ast":null,"code":"import { Slot } from '@wry/context';\nimport { dep } from 'optimism';\nvar varDep = dep();\nvar cacheSlot = new Slot();\n\nfunction makeVar(value) {\n  var caches = new Set();\n  return function rv(newValue) {\n    if (arguments.length > 0) {\n      if (value !== newValue) {\n        value = newValue;\n        varDep.dirty(rv);\n        caches.forEach(broadcast);\n      }\n    } else {\n      var cache = cacheSlot.getValue();\n      if (cache) caches.add(cache);\n      varDep(rv);\n    }\n\n    return value;\n  };\n}\n\nfunction broadcast(cache) {\n  if (cache.broadcastWatches) {\n    cache.broadcastWatches();\n  }\n}\n\nexport { cacheSlot, makeVar };","map":{"version":3,"sources":["reactiveVars.js"],"names":[],"mappings":";;AAEA,IAAI,MAAM,GAAG,GAAG,EAAhB;AACU,IAAC,SAAS,GAAG,IAAI,IAAJ,EAAb;;AACH,SAAS,OAAT,CAAiB,KAAjB,EAAwB;AAC3B,MAAI,MAAM,GAAG,IAAI,GAAJ,EAAb;AACA,SAAO,SAAS,EAAT,CAAY,QAAZ,EAAsB;AACzB,QAAI,SAAS,CAAC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,UAAI,KAAK,KAAK,QAAd,EAAwB;AACpB,QAAA,KAAK,GAAG,QAAR;AACA,QAAA,MAAM,CAAC,KAAP,CAAa,EAAb;AACA,QAAA,MAAM,CAAC,OAAP,CAAe,SAAf;AACH;AACJ,KAND,MAOK;AACD,UAAI,KAAK,GAAG,SAAS,CAAC,QAAV,EAAZ;AACA,UAAI,KAAJ,EACI,MAAM,CAAC,GAAP,CAAW,KAAX;AACJ,MAAA,MAAM,CAAC,EAAD,CAAN;AACH;;AACD,WAAO,KAAP;AACH,GAfD;AAgBH;;AACD,SAAS,SAAT,CAAmB,KAAnB,EAA0B;AACtB,MAAI,KAAK,CAAC,gBAAV,EAA4B;AACxB,IAAA,KAAK,CAAC,gBAAN;AACH;AACL","sourcesContent":["import { Slot } from \"@wry/context\";\nimport { dep } from \"optimism\";\nvar varDep = dep();\nexport var cacheSlot = new Slot();\nexport function makeVar(value) {\n    var caches = new Set();\n    return function rv(newValue) {\n        if (arguments.length > 0) {\n            if (value !== newValue) {\n                value = newValue;\n                varDep.dirty(rv);\n                caches.forEach(broadcast);\n            }\n        }\n        else {\n            var cache = cacheSlot.getValue();\n            if (cache)\n                caches.add(cache);\n            varDep(rv);\n        }\n        return value;\n    };\n}\nfunction broadcast(cache) {\n    if (cache.broadcastWatches) {\n        cache.broadcastWatches();\n    }\n}\n//# sourceMappingURL=reactiveVars.js.map"]},"metadata":{},"sourceType":"module"}